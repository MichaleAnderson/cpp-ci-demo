name: C++ CI Pipeline (CentOS 7 Compatible)

on:
  push:
    branches: [ "master" ]
  pull_request:
    branches: [ "master" ]

jobs:
  build:
    runs-on: ubuntu-latest

    container:
      image: centos:7

    steps:
      - name: Fix CentOS 7 Base Repositories (Vault)
        run: |
          sed -i 's|mirrorlist=|#mirrorlist=|g' /etc/yum.repos.d/CentOS-*.repo
          sed -i 's|#baseurl=http://mirror.centos.org/centos/|baseurl=http://vault.centos.org/centos/|g' /etc/yum.repos.d/CentOS-*.repo

      - name: Disable SCL repos (not present in minimal container)
        run: |
          yum-config-manager --disable centos-sclo-rh centos-sclo-sclo || true

      - name: Install Developer Tools
        run: |
          yum clean all
          yum -y update
          yum -y install gcc gcc-c++ make

      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Build Program
        run: |
          mkdir -p out
          cd out
          g++ -std=c++17 ../src/main.cpp -o app -static-libstdc++ -static-libgcc

      - name: Upload Build Artifact
        uses: actions/upload-artifact@v4
        with:
          name: my-app
          path: out/app
